<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Requests — HelpAroundYou</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />

</head>

<body>

  <header class="site-header compact">

    <a class="brand" href="index.html">Help<span class="brand-accent">Around</span>You</a>

    <nav class="site-nav">

      <a class="nav-link" href="post.html">Post</a>

      <a class="nav-link" href="#filters">Filters</a>

    </nav>

  </header>



  <main class="section">

    <div class="container">

      <h1 class="section-title">Requests near you</h1>



      <div id="filters" class="card form-card" style="margin-bottom:16px">

        <div class="form-row two">

          <div>

            <label for="fCat">Category</label>

            <select id="fCat">

              <option value="">All</option>

              <option>Lawn care</option>

              <option>Moving / Truck pickup</option>

              <option>Cleaning</option>

              <option>Repairs / Assembly</option>

              <option>Custom task</option>

            </select>

          </div>

          <div>

            <label for="fZip">ZIP / Area</label>

            <input id="fZip" type="text" placeholder="e.g., 40218" />

          </div>

        </div>

        <div class="form-actions">

          <button class="btn btn-primary" id="apply">Apply</button>

          <button class="btn btn-ghost" id="clear">Clear</button>

        </div>

      </div>



      <div id="cards" class="cards-grid"></div>

    </div>

  </main>



  <footer class="site-footer">

    <div class="container">

      <p class="muted">HelpAroundYou connects neighbors and local doers. Coordinate time and payment directly with each other.</p>

    </div>

  </footer>



  <script>

    const API = ''; // نفس الدومين

    const cards = document.getElementById('cards');



    const el = (tag, cls, txt) => { const n=document.createElement(tag); if(cls)n.className=cls; if(txt!==undefined)n.textContent=txt; return n; };



    function render(list){

      cards.innerHTML = '';

      if (!list.length){ cards.innerHTML = '<p class="muted">No requests found.</p>'; return; }

      list.forEach(item => {

        const card = el('article','card request-card');

        const head = el('div','req-head');

        head.append(el('span','req-icon','🧰'), el('h3','req-title', item.title));

        card.append(head);



        const meta = el('div','req-meta');

        meta.append(el('span','badge', item.category || '—'),

                    el('span','dot','•'),

                    el('span','muted', item.zip || ''),

                    el('span','dot','•'));

        const when = [item.need_date, item.need_time].filter(Boolean).join(' • ');

        meta.append(el('span','muted', when || 'Flexible'));

        card.append(meta);



        if (item.description) card.append(el('p','req-desc', item.description));



        const actions = el('div','req-actions');

        const offer = el('a','btn btn-primary','Offer help'); offer.href='post.html';

        actions.append(offer);



        if (Array.isArray(item.files) && item.files.length){

          const link = document.createElement('a');

          link.className = 'btn btn-ghost';

          link.textContent = 'View file';

          link.href = item.files[0].url; link.target='_blank'; link.rel='noopener';

          actions.append(link);

        } else {

          const details = el('a','btn btn-ghost','Details'); details.href='#';

          actions.append(details);

        }

        card.append(actions);

        cards.append(card);

      });

    }



    async function load({cat='',zip=''}={}){

      const url = new URL(`${API}/api/requests`, window.location.origin);

      if (cat) url.searchParams.set('cat',cat);

      if (zip) url.searchParams.set('zip',zip);

      const r = await fetch(url);

      const { data } = await r.json();

      render(data || []);

    }



    // initial + filters

    load();

    document.getElementById('apply').onclick = () => {

      const cat = document.getElementById('fCat').value;

      const zip = document.getElementById('fZip').value.trim();

      load({cat,zip});

      window.scrollTo({ top: cards.offsetTop - 80, behavior: 'smooth' });

    };

    document.getElementById('clear').onclick = () => {

      document.getElementById('fCat').value = '';

      document.getElementById('fZip').value = '';

      load();

    };

  </script>

</body>

</html>
